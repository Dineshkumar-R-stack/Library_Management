<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SASTRA Library Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@700&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      font-family: 'Libre Baskerville', serif;
      background: url('loginfbg.jpg') no-repeat center center fixed;
      background-size: cover;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #facc15;
      overflow: hidden;
    }

    .login-container {
      background-color: rgba(30, 20, 10, 0.95);
      border: 2px solid rgba(255, 204, 77, 0.2);
      border-radius: 1rem;
      padding: 3rem 2.5rem;
      max-width: 520px;
      width: 100%;
      box-shadow:
        0 0 0 3px rgba(252, 211, 77, 0.05),
        0 12px 30px rgba(0, 0, 0, 0.45);
      text-align: center;
      animation: fadeIn 0.8s ease-out forwards;
      opacity: 0;
      transform: translateY(20px);
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h2 {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
      color: #facc15;
    }

    .subtext {
      font-size: 0.9rem;
      color: #fef9c3;
      margin-bottom: 2rem;
    }

    .form-group {
      margin-bottom: 1.2rem;
      text-align: left;
      position: relative;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.4rem;
      font-size: 0.95rem;
      color: #fef08a;
    }

    .form-group input {
      width: 100%;
      padding: 0.75rem 1rem;
      background-color: #2f1b0e;
      border: none;
      border-radius: 0.6rem;
      font-size: 1rem;
      color: #facc15;
    }

    .form-group input::placeholder {
      color: #facc15;
      opacity: 0.7;
    }

    .toggle-password {
      position: absolute;
      top: 2.6rem;
      right: 1rem;
      cursor: pointer;
      font-size: 1rem;
      color: #facc15;
    }

    .remember {
      font-size: 0.85rem;
      color: #fde68a;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .forgot-password {
      display: block;
      text-align: right;
      font-size: 0.8rem;
      color: #fde68a;
      margin-top: -0.5rem;
      margin-bottom: 1.5rem;
      text-decoration: none;
      cursor: pointer;
    }

    .forgot-password:hover {
      text-decoration: underline;
    }

    .captcha-box {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      margin-bottom: 1rem;
    }

    canvas {
      border-radius: 8px;
      cursor: pointer;
      background: #1f150b;
    }

    .error-message {
      color: #f87171;
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .login-button {
      width: 100%;
      padding: 0.8rem;
      background: linear-gradient(to right, #facc15, #fbbf24);
      border: none;
      border-radius: 0.6rem;
      color: #1e1b16;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .login-button:hover {
      background: #fbbf24;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.3);
    }

    footer {
      position: absolute;
      bottom: 20px;
      font-size: 0.8rem;
      color: #fef9c3;
    }
  </style>
</head>
<body>
  <div class="login-container">
	<div style="display: flex; align-items: center; justify-content: center; gap: 0.8rem; margin-bottom: 1rem;">
	  <img src="sastra_logo.jpg" alt="SASTRA University Logo" style="height: 50px;">
	  <h2 style="margin: 0; font-size: 1.8rem; color: #facc15;">SASTRA Library Portal</h2>
	</div>
    <p class="subtext" id="greeting">Welcome, SASTRA student!</p>

    <form id="loginForm">
      <div class="form-group">
        <label for="regNo">Registration Number</label>
        <input type="text" id="regNo" placeholder="Enter your register number" required />
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Enter your password" required />
        <span class="toggle-password" onclick="togglePassword()">üëÅÔ∏è</span>
      </div>

      <div class="form-group">
        <label>CAPTCHA</label>
        <div class="captcha-box">
          <canvas id="captchaCanvas" width="130" height="40" title="Click to refresh"></canvas>
          <input type="text" id="captchaInput" placeholder="Enter code" required />
        </div>
      </div>

      <a class="forgot-password" onclick="alert('Your password is your registration number for first login.')">Forgot password?</a>

      <div class="remember">
        <input type="checkbox" id="remember" />
        <label for="remember">Remember me</label>
      </div>

      <p class="error-message" id="error"></p>

      <button type="submit" class="login-button">
        <span id="btn-text">Enter Library</span>
        <span id="btn-spinner" style="display: none;">‚è≥</span>
      </button>
    </form>
  </div>

  <footer>¬© 2025 SASTRA University Library. All rights reserved.</footer>

  <script>
    const form = document.getElementById("loginForm");
    const regNoInput = document.getElementById("regNo");
    const passwordInput = document.getElementById("password");
    const captchaInput = document.getElementById("captchaInput");
    const errorElement = document.getElementById("error");
    const btnText = document.getElementById("btn-text");
    const btnSpinner = document.getElementById("btn-spinner");

    let captchaCode = "";

    function drawCaptcha() {
      const canvas = document.getElementById("captchaCanvas");
      const ctx = canvas.getContext("2d");
      const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
      captchaCode = "";
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#1f150b";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      for (let i = 0; i < 5; i++) {
        captchaCode += chars[Math.floor(Math.random() * chars.length)];
      }

      ctx.font = "22px Georgia";
      ctx.fillStyle = "#fde68a";
      ctx.setTransform(1, 0, 0, 1, 10, 28);
      for (let i = 0; i < 5; i++) {
        const letter = captchaCode[i];
        const x = i * 22;
        const y = Math.random() * 4;
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate((Math.random() - 0.5) * 0.4);
        ctx.fillText(letter, 0, 0);
        ctx.restore();
      }

      for (let i = 0; i < 4; i++) {
        ctx.beginPath();
        ctx.moveTo(Math.random() * canvas.width, Math.random() * canvas.height);
        ctx.lineTo(Math.random() * canvas.width, Math.random() * canvas.height);
        ctx.strokeStyle = "#555";
        ctx.lineWidth = 1;
        ctx.stroke();
      }

      ctx.setTransform(1, 0, 0, 1, 0, 0);
    }

    drawCaptcha();
    document.getElementById("captchaCanvas").addEventListener("click", drawCaptcha);

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const regNo = regNoInput.value.trim();
      const password = passwordInput.value.trim();
      const enteredCaptcha = captchaInput.value.trim().toUpperCase();
      const regNoPattern = /^12\d{7}$/;

      errorElement.textContent = "";

      if (!regNoPattern.test(regNo) || !regNoPattern.test(password)) {
        errorElement.textContent = "Invalid Registration Number or Password";
        return;
      }

      if (enteredCaptcha !== captchaCode) {
        errorElement.textContent = "Incorrect CAPTCHA code.";
        drawCaptcha();
        return;
      }

      btnText.style.display = "none";
      btnSpinner.style.display = "inline";

      setTimeout(() => {
        btnText.style.display = "inline";
        btnSpinner.style.display = "none";

        if (regNo === "127003081" && password === "127003081") {
          localStorage.setItem("regno", regNo);
          localStorage.setItem("name", "Hamdhan Ahmed S");
          localStorage.setItem("dept", "Computer Science");
          localStorage.setItem("designation", "Student");
          localStorage.setItem("valid_until", "Jun 2027");
          window.location.href = "mainpage_m.html";
        } else {
          errorElement.textContent = "Invalid registration number or password.";
        }
      }, 1500);
    });

    function togglePassword() {
      const pwd = document.getElementById("password");
      pwd.type = pwd.type === "password" ? "text" : "password";
    }

    const hour = new Date().getHours();
    const greet = hour < 12 ? "Good morning" : hour < 18 ? "Good afternoon" : "Good evening";
    document.getElementById("greeting").innerText = `${greet}, SASTRA student!`;
  </script>
</body>
</html>
